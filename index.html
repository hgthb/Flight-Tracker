<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PXU FLIGHT RADAR - A.2</title>
    <style>
        /* Giao diện tối chuyên nghiệp cho FIDS */
        body { 
            background: #0b0e14; 
            color: #e0e0e0; 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 15px; 
        }

        h2 { 
            color: #64ffda; 
            text-align: center; 
            font-size: 1.2em; 
            text-transform: uppercase; 
            margin-bottom: 20px;
        }

        /* Container hỗ trợ trượt ngang trên điện thoại */
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border: 1px solid #242933;
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px; /* Đảm bảo chiều ngang để hiển thị các cột */
        }

        th {
            background: #1c212c;
            color: #8892b0;
            text-align: left;
            padding: 12px;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #64ffda;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #242933;
            vertical-align: middle;
        }

        /* Định dạng các ô dữ liệu */
        .flight-no { font-weight: bold; color: #ffffff; font-size: 1em; }
        .reg-no { color: #ffa502; font-family: monospace; font-size: 0.9em; }
        .icao-code { color: #64ffda; font-weight: 500; }
        
        /* Cấu trúc giờ 2 hàng trong 1 ô */
        .time-group {
            display: flex;
            flex-direction: column;
            line-height: 1.3;
        }
        .sched {
            color: #8892b0;
            font-size: 0.8em;
            font-weight: normal;
        }
        .real {
            color: #f7d794;
            font-size: 1em;
            font-weight: bold;
        }

        /* Hiệu ứng dòng khi di chuyển chuột */
        tr:hover { background: #161b22; }
    </style>
</head>
<body>

    <h2>✈️ PLEIKU AIRPORT REALTIME (A.2)</h2>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Chuyến bay</th>
                    <th>Đăng bạ (Reg)</th>
                    <th>Lộ trình (ICAO)</th>
                    <th>Cất cánh (S/A)</th>
                    <th>Hạ cánh (S/A)</th>
                </tr>
            </thead>
            <tbody id="flight-data">
                </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // --- ID CỐ ĐỊNH: Anh dán cấu hình Firebase của anh vào đây ---
        const firebaseConfig = {
            apiKey: "AIzaSy...",
            authDomain: "pleiku-flight-radar.firebaseapp.com",
            databaseURL: "https://pleiku-flight-radar-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pleiku-flight-radar",
            storageBucket: "pleiku-flight-radar.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const flightTable = document.getElementById('flight-data');

        // Lắng nghe dữ liệu realtime
        onValue(ref(db, 'flight_logs'), (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            // Chuyển object thành array và sắp xếp theo thời gian
            const flights = Object.values(data).sort((a, b) => a.raw_sort_time - b.raw_sort_time);

            flightTable.innerHTML = flights.map(f => `
                <tr>
                    <td class="flight-no">${f.flight}</td>
                    <td class="reg-no">${f.reg}</td>
                    <td class="icao-code">${f.origin_icao} ➔ ${f.dest_icao}</td>
                    <td>
                        <div class="time-group">
                            <span class="sched">${f.dep_sched}</span>
                            <span class="real">${f.dep_real}</span>
                        </div>
                    </td>
                    <td>
                        <div class="time-group">
                            <span class="sched">${f.arr_sched}</span>
                            <span class="real">${f.arr_real}</span>
                        </div>
                    </td>
                </tr>
            `).join('');
        });
    </script>
</body>
</html>
